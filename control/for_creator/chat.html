<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë£¨ì›¨ì¸ ì‹¤ì‹œê°„ ì—°ê²° í…ŒìŠ¤íŠ¸</title>
  <style>
    body { background-color:#000; color:#0f0; font-family:Consolas, monospace; padding:20px; }
    #log { white-space:pre-wrap; }
    input, button { font-size:16px; }
  </style>
</head>
<body>
  <h2>ğŸŒ ë£¨ì›¨ì¸ ì‹¤ì‹œê°„ ì—°ê²° ìƒíƒœ</h2>
  <div id="log">ì´ˆê¸°í™” ì¤‘...</div>

  <script type="module">
    const log = (msg, color="lime") => {
      const el = document.createElement("div");
      el.style.color = color;
      el.textContent = msg;
      document.getElementById("log").appendChild(el);
    };

    // âš™ï¸ Supabase ê¸°ë³¸ê°’
    const SUPABASE_URL = "https://omchtafaagkdwcwrvscrp.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9tY2h0YWZhcWdrZHdjcndzY3JwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODIyNjMsImV4cCI6MjA3NDQ1ODI2M30.vGV6Gfgi1V8agiwL03ho2R7BAwv4CrTp6-RGH0S3-4g"; // anon í‚¤ë¡œ êµì²´
    const TABLE_NAME = "todo_luwain";

    log("ğŸ”„ WebSocket ì—°ê²° ì‹œë„ ì¤‘...");

    const socket = new WebSocket(`${SUPABASE_URL.replace('https','wss')}/realtime/v1/websocket?apikey=${SUPABASE_KEY}`);

    socket.onopen = () => log("âœ… ì—°ê²° ì„±ê³µ");
    socket.onclose = () => log("âŒ ì—°ê²° ì¢…ë£Œ","red");
    socket.onerror = (e) => log("âš ï¸ ì˜¤ë¥˜ ë°œìƒ: " + e.message,"yellow");

    socket.onmessage = (event) => {
      log("ğŸ“¨ ë°ì´í„° ìˆ˜ì‹ ë¨: " + event.data);
    };

    // êµ¬ë… ì„¤ì • (ì‹¤ì‹œê°„ ë³€ê²½ ê°ì§€)
    setTimeout(() => {
      const subscribeMsg = {
        event: "phx_join",
        payload: {},
        ref: 1,
        topic: `realtime:public:${TABLE_NAME}`
      };
      socket.send(JSON.stringify(subscribeMsg));
      log(`ğŸ§© ${TABLE_NAME} êµ¬ë… ìš”ì²­ ë³´ëƒ„`);
    }, 1000);
  </script>
</body>
</html>
