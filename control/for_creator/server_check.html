<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë£¨ì›¨ì¸ ì„œë²„ ì—°ê²° ìƒíƒœ (Supabase WebSocket)</title>
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; margin: 2rem; }
    input { width: 600px; padding: 4px; }
    button { padding: 4px 10px; margin-left: 8px; }
    pre { background: #111; color: #0f0; padding: 10px; height: 200px; overflow: auto; }
  </style>
</head>
<body>
  <h3>ë£¨ì›¨ì¸ ì„œë²„ ì—°ê²° ìƒíƒœ (Supabase WebSocket)</h3>
  <input id="addr" type="text" value="wss://omchtafaagkdwcwrvscrp.supabase.co/realtime/v1/websocket">
  <button onclick="check()">ì²´í¬</button>
  <pre id="log"></pre>

  <script>
    async function check() {
      const addr = document.getElementById("addr").value;
      const log = document.getElementById("log");
      log.textContent = "â³ ì—°ê²° ì‹œë„ ì¤‘...\n";

      // ğŸ”‘ Supabase anon key (Settings â†’ API â†’ Project API keys)
      const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9tY2h0YWZhcWdrZHdjcndzY3JwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODIyNjMsImV4cCI6MjA3NDQ1ODI2M30.vGV6Gfgi1V8agiwL03ho2R7BAwv4CrTp6-RGH0S3-4g";

      // ğŸ§  ì—°ê²°ìš© payload
      const URL = `${addr}?apikey=${SUPABASE_KEY}&vsn=1.0.0`;

      try {
        const socket = new WebSocket(URL);

        socket.onopen = () => {
          log.textContent += "âœ… WebSocket ì—°ê²° ì„±ê³µ!\n";
          socket.send(JSON.stringify({
            topic: "realtime:*",
            event: "phx_join",
            payload: {},
            ref: 1
          }));
        };

        socket.onmessage = (msg) => {
          log.textContent += "ğŸ“© ë©”ì‹œì§€ ìˆ˜ì‹ :\n" + msg.data + "\n";
        };

        socket.onerror = (err) => {
          log.textContent += "âŒ ì—°ê²° ì˜¤ë¥˜: " + err.message + "\n";
        };

        socket.onclose = () => {
          log.textContent += "âš™ï¸ ì—°ê²° ì¢…ë£Œë¨\n";
        };

      } catch (e) {
        log.textContent += "ğŸš« ì—°ê²° ì˜ˆì™¸ ë°œìƒ: " + e.message + "\n";
      }
    }
  </script>
</body>
</html>
