<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê°ì„±ì¼ê¸° | ë£¨ì›¨ì¸</title>
  <link rel="stylesheet" href="style.css" />
  <script src="script.js" defer></script>
<!-- header.html ì˜ </head> ë°”ë¡œ ìœ„ìª½ì— ì¶”ê°€ -->
<script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
<script type="module" src="/scripts/memory_policies.js" defer></script>
<link rel="manifest" href="/manifest.json">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(reg => console.log('ServiceWorker registered:', reg))
      .catch(err => console.warn('ServiceWorker registration failed:', err));
  });
}
</script>

</head>
<body>
  <!-- í—¤ë” ìë™ í¬í•¨ -->
  <div id="luwein-header"></div>

  <main>
    <h1>ê°ì„±ì¼ê¸° Emotional Diary</h1>
    <p>ë‹¹ì‹ ì˜ í•˜ë£¨ë¥¼ ì–¸ì–´ë¡œ ê¸°ë¡í•´ë³´ì„¸ìš”.</p>
    <a href="first_time.html" class="button">ì²˜ìŒ ì“°ê¸°</a>
    <a href="returning_user.html" class="button">ì´ì–´ì“°ê¸°</a>
  </main>

  <!-- í‘¸í„° ìë™ í¬í•¨ -->
  <div id="luwein-footer"></div>

  <script>
    fetch("../../includes/header.html")
      .then(res => res.text())
      .then(html => document.getElementById("luwein-header").innerHTML = html);

    fetch("../../includes/footer.html")
      .then(res => res.text())
      .then(html => document.getElementById("luwein-footer").innerHTML = html);
  </script>
<!-- âœ… í—¤ë” -->
<div id="luwein-header"></div>
<script>
(async()=>{
  const paths=["../includes/header.html","../../includes/header.html","/includes/header.html"];
  for(const p of paths){
    try{
      const r=await fetch(p,{cache:"no-cache"});
      if(r.ok){document.getElementById("luwein-header").innerHTML=await r.text();return;}
    }catch(e){}
  }
})();
</script>

<!-- âœ… í‘¸í„° -->
<div id="luwein-footer"></div>
<script>
(async()=>{
  const paths=["../includes/footer.html","../../includes/footer.html","/includes/footer.html"];
  for(const p of paths){
    try{
      const r=await fetch(p,{cache:"no-cache"});
      if(r.ok){document.getElementById("luwein-footer").innerHTML=await r.text();return;}
    }catch(e){}
  }
})();
</script>
<!-- index.html ë§¨ ì•„ë˜ìª½ ë¶€ë¶„ ì˜ˆì‹œ -->
...
  <!-- í‘¸í„°ë‚˜ ê¸°íƒ€ ìŠ¤í¬ë¦½íŠ¸ê°€ ëë‚˜ëŠ” ë¶€ë¶„ -->

  <!-- ì—¬ê¸° ì•„ë˜ì— ë¶™ì´ë©´ ë¨ -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm"

    const SUPABASE_URL = "https://omchtafaqgkdwcrwscrp.supabase.co"
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9tY2h0YWZhcWdrZHdjcndzY3JwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODIyNjMsImV4cCI6MjA3NDQ1ODI2M30.vGV6Gfgi1V8agiwL03ho2R7BAwv4CrTp6-RGH0S3-4g"
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ â†’ ë²„íŠ¼ í™œì„±/ë¹„í™œì„±
    document.addEventListener("DOMContentLoaded", async () => {
      const firstBtn = document.getElementById("firstBtn")
      const continueBtn = document.getElementById("continueBtn")

      // ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”
      if (firstBtn) firstBtn.disabled = true
      if (continueBtn) continueBtn.disabled = true

      const { data: { session } } = await supabase.auth.getSession()
      if (session) {
        // ë¡œê·¸ì¸ ëœ ì‚¬ìš©ì â†’ ë²„íŠ¼ í™œì„±í™”
        if (firstBtn) firstBtn.disabled = false
        if (continueBtn) continueBtn.disabled = false
      } else {
        // ë¹„ë¡œê·¸ì¸ â†’ ë¡œê·¸ì¸ ìœ ë„
        alert("ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.")
      }
    })
  </script>
<!-- íšŒì› ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm"

  // ğŸ”¹ ì‹¤ì œ í”„ë¡œì íŠ¸ URLê³¼ ê³µê°œ í‚¤ë¡œ êµì²´
  const SUPABASE_URL = "https://YOUR_PROJECT.supabase.co"
  const SUPABASE_KEY = "YOUR_PUBLIC_ANON_KEY"
  const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

  document.addEventListener("DOMContentLoaded", async () => {
    // ì²˜ìŒì“°ê¸°Â·ì´ì–´ì“°ê¸° ë²„íŠ¼
    const firstBtn = document.getElementById("firstBtn")
    const continueBtn = document.getElementById("continueBtn")

    // ë²„íŠ¼ ê¸°ë³¸ ë¹„í™œì„±í™”
    if (firstBtn) firstBtn.disabled = true
    if (continueBtn) continueBtn.disabled = true

    // ë¡œê·¸ì¸ ì„¸ì…˜ í™•ì¸
    const { data: { session } } = await supabase.auth.getSession()

    if (session) {
      // ë¡œê·¸ì¸ ì™„ë£Œ â†’ ë²„íŠ¼ í™œì„±í™”
      if (firstBtn) firstBtn.disabled = false
      if (continueBtn) continueBtn.disabled = false
      console.log("ë¡œê·¸ì¸ëœ ì‚¬ìš©ì:", session.user.email)
    } else {
      // ë¯¸ë¡œê·¸ì¸ â†’ ì•ˆë‚´ í‘œì‹œ
      alert("ë¡œê·¸ì¸ í›„ ê°ì„±ì¼ê¸°ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
    }
  })
</script>
<!-- ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì½”ë“œ -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm"

  const SUPABASE_URL = "https://omchtafaqgkdwcrwscrp.supabase.co"
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9tY2h0YWZhcWdrZHdjcndzY3JwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODIyNjMsImV4cCI6MjA3NDQ1ODI2M30.vGV6Gfgi1V8agiwL03ho2R7BAwv4CrTp6-RGH0S3-4g"
  const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

  document.addEventListener("DOMContentLoaded", async () => {
    const firstBtn = document.getElementById("firstBtn")
    const continueBtn = document.getElementById("continueBtn")

    // ê¸°ë³¸ ë¹„í™œì„±í™”
    if (firstBtn) firstBtn.disabled = true
    if (continueBtn) continueBtn.disabled = true

    // ë¡œê·¸ì¸ ì„¸ì…˜ í™•ì¸
    const { data: { session } } = await supabase.auth.getSession()

    if (session) {
      if (firstBtn) firstBtn.disabled = false
      if (continueBtn) continueBtn.disabled = false
      console.log("ë¡œê·¸ì¸ëœ ì‚¬ìš©ì:", session.user.email)
    } else {
      alert("ë¡œê·¸ì¸ í›„ ê°ì„±ì¼ê¸°ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
    }
  })
</script>

</body>
</html>

