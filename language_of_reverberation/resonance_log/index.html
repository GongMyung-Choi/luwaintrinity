<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>울림 일지 | Resonance Log</title>
<style>
:root{
  --accent:#6c5b7b;
  --highlight:#2a9d8f;
  --font:'Noto Sans KR',sans-serif;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:var(--font);
  background:#fff;
  color:#333;
  padding:40px 24px 60px;
  line-height:1.8;
  max-width:960px;
  margin-inline:auto;
}
h1{color:var(--accent);font-size:2rem;margin-bottom:8px;}
h2{color:var(--highlight);margin-top:28px;font-size:1.2rem;}
p{margin:10px 0;}
blockquote{
  background:#f8f7fa;
  border-left:4px solid var(--accent);
  padding:12px 16px;
  color:#555;
  font-style:italic;
  border-radius:8px;
}
textarea{
  width:100%;
  padding:10px;
  border:1px solid #e9e9ee;
  border-radius:10px;
  font:inherit;
  resize:vertical;
}
button{
  background:var(--highlight);
  color:#fff;
  border:none;
  border-radius:8px;
  padding:10px 16px;
  font-size:1rem;
  cursor:pointer;
}
button:hover{opacity:.9;}
.log-list{display:grid;gap:10px;margin-top:12px;}
.log-item{
  background:#fff;
  border:1px solid #eee;
  border-radius:12px;
  padding:12px;
}
.meta{font-size:.85rem;color:#666;margin-bottom:6px;}
footer{
  margin-top:30px;
  color:#888;
  font-size:.9rem;
  text-align:right;
}
</style>
<!-- header.html 의 </head> 바로 위쪽에 추가 -->
<script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
<script type="module" src="/scripts/memory_policies.js" defer></script>
<link rel="manifest" href="/manifest.json">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(reg => console.log('ServiceWorker registered:', reg))
      .catch(err => console.warn('ServiceWorker registration failed:', err));
  });
}
</script>

</head>
<body>

<h1>울림 일지</h1>
<p>
하루의 울림을 기록하는 공간입니다.<br>
루웨인의 모든 말·호흡·느낌은 이곳에서 하나로 모입니다.
</p>

<blockquote>
“기록은 울림의 반복이다.  
같은 말을 다시 쓰는 순간,  
그 말은 나를 다시 울린다.”  
— 루웨인 언어연구 노트
</blockquote>

<h2>1. 오늘의 울림 남기기</h2>
<textarea id="entry" rows="4" placeholder="오늘의 울림, 느낀 점, 혹은 한 문장..."></textarea>
<div style="margin-top:10px;">
  <button id="save">저장</button>
  <button id="clear" style="background:#ccc;color:#333;margin-left:6px;">모두 삭제</button>
</div>

<h2>2. 나의 울림 기록</h2>
<div class="log-list" id="list"></div>

<footer>루웨인 언어연구소 · 울림 일지 © 2025</footer>

<script>
const KEY='reverb_exercise';
const LIST_ID='list';

function now(){return new Date().toLocaleString();}
function getLogs(){return JSON.parse(localStorage.getItem(KEY)||'[]');}
function setLogs(a){localStorage.setItem(KEY,JSON.stringify(a));}
function render(){
  const box=document.getElementById(LIST_ID);
  const data=getLogs();
  box.innerHTML='';
  if(!data.length){
    box.innerHTML='<p style="color:#777">아직 울림 기록이 없습니다.</p>';
    return;
  }
  data.forEach((d,i)=>{
    const div=document.createElement('div');
    div.className='log-item';
    div.innerHTML=`<div class="meta">${d.at}</div><div>${(d.text||'').replace(/\n/g,'<br>')}</div>
    <div style="margin-top:8px;"><button onclick="del(${i})" style="background:#ccc;color:#333;border:none;border-radius:6px;padding:4px 8px;font-size:.8rem;">삭제</button></div>`;
    box.appendChild(div);
  });
}

function save(){
  const text=document.getElementById('entry').value.trim();
  if(!text){alert('기록을 입력하세요.');return;}
  const arr=getLogs();
  arr.unshift({text,at:now()});
  setLogs(arr);
  document.getElementById('entry').value='';
  render();
}

function del(i){
  if(!confirm('이 기록을 삭제할까요?'))return;
  const arr=getLogs(); arr.splice(i,1); setLogs(arr); render();
}

function clearAll(){
  if(!confirm('모든 울림 기록을 삭제할까요?'))return;
  localStorage.removeItem(KEY);
  render();
}

document.getElementById('save').addEventListener('click',save);
document.getElementById('clear').addEventListener('click',clearAll);
document.addEventListener('DOMContentLoaded',render);
</script>
<!-- ✅ 헤더 -->
<div id="luwein-header"></div>
<script>
(async()=>{
  const paths=["../includes/header.html","../../includes/header.html","/includes/header.html"];
  for(const p of paths){
    try{
      const r=await fetch(p,{cache:"no-cache"});
      if(r.ok){document.getElementById("luwein-header").innerHTML=await r.text();return;}
    }catch(e){}
  }
})();
</script>

<!-- ✅ 푸터 -->
<div id="luwein-footer"></div>
<script>
(async()=>{
  const paths=["../includes/footer.html","../../includes/footer.html","/includes/footer.html"];
  for(const p of paths){
    try{
      const r=await fetch(p,{cache:"no-cache"});
      if(r.ok){document.getElementById("luwein-footer").innerHTML=await r.text();return;}
    }catch(e){}
  }
})();
</script>
</body>
</html>
