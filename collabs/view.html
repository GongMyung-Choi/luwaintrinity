<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í˜‘ì—… ìƒì„¸ ë³´ê¸°</title>
<link rel="stylesheet" href="collab_style.css">
<script type="module">
import { fetchCollabById, addComment, fetchComments } from "./collab_api.js";

const urlParams = new URLSearchParams(location.search);
const collabId = urlParams.get("id");
const main = document.getElementById("main");
const commentList = document.getElementById("comments");
const input = document.getElementById("commentInput");
const personaInput = document.getElementById("personaInput");

async function render() {
  const data = await fetchCollabById(collabId);
  if (!data) return main.innerHTML = "<p>í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
  main.innerHTML = `
    <div class="card">
      <h2>${data.title}</h2>
      <p><b>ìœ í˜•:</b> ${data.type}</p>
      <p><b>í¼ìŠ¤ë‚˜:</b> ${data.persona_name}</p>
      <small>${new Date(data.ts).toLocaleString()}</small>
      <p>${data.detail?.desc || ''}</p>
    </div>
  `;
  loadComments();
}

async function loadComments() {
  const comments = await fetchComments(collabId);
  commentList.innerHTML = comments.map(c => `
    <div class="comment">
      <small>${c.detail.persona} | ${new Date(c.ts).toLocaleTimeString()}</small>
      <p>${c.detail.comment}</p>
    </div>
  `).join("");
}

document.getElementById("sendBtn").addEventListener("click", async () => {
  const persona = personaInput.value.trim() || "ìµëª…";
  const text = input.value.trim();
  if (!text) return;
  await addComment(collabId, persona, text);
  input.value = "";
  loadComments();
});

render();
</script>
</head>
<body>
  <header>
    <h1>ğŸ“ í˜‘ì—… í”„ë¡œì íŠ¸ ìƒì„¸</h1>
  </header>

  <main id="main" class="main"></main>

  <section class="main">
    <h3>ğŸ’¬ í¼ìŠ¤ë‚˜ ì½”ë©˜íŠ¸</h3>
    <div id="comments"></div>
    <div class="comment-box">
      <input id="personaInput" placeholder="í¼ìŠ¤ë‚˜ ì´ë¦„" />
      <textarea id="commentInput" rows="3" placeholder="ì½”ë©˜íŠ¸ ì…ë ¥..."></textarea>
      <button id="sendBtn">ë“±ë¡</button>
    </div>
  </section>
</body>
</html>
