<!DOCTYPE html>
<html lang="ko">
<head>
<link rel="manifest" href="/manifest.json">
<script src="/app_ready_patch/install_prompt.js" defer></script>
<script>
  window.addEventListener("beforeinstallprompt", e => {
    e.preventDefault();
    window.deferredPrompt = e;
    const installBtn = document.createElement("button");
    installBtn.textContent = "ğŸ“± ë£¨ì›¨ì¸ ì•± ì„¤ì¹˜í•˜ê¸°";
    installBtn.style.position = "fixed";
    installBtn.style.bottom = "20px";
    installBtn.style.right = "20px";
    installBtn.style.zIndex = "9999";
    installBtn.style.padding = "12px 18px";
    installBtn.style.borderRadius = "10px";
    installBtn.style.border = "none";
    installBtn.style.background = "#2563eb";
    installBtn.style.color = "white";
    installBtn.onclick = async () => {
      window.deferredPrompt.prompt();
      const { outcome } = await window.deferredPrompt.userChoice;
      if (outcome === "accepted") installBtn.remove();
      window.deferredPrompt = null;
    };
    document.body.appendChild(installBtn);
  });
</script>


<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë£¨ì›¨ì¸ íŠ¸ë¦¬ë‹ˆí‹°</title>
<style id="themeVars">
:root{
  --header-color:#af2465;
  --menu-bg-color:#6c5b7b;
  --menu-text-color:#ffffff;
  --menu-hover-text:#2a9d8f;
  --btn-border:#2a9d8f;
  --btn-text:#2a9d8f;
  --btn-hover-bg:#2a9d8f;
  --btn-hover-text:#ffffff;
  --menu-size:16px;
  --submenu-size:14px;
  --title-size:40px;
  --intro-strong-size:42px;
  --intro-message-size:18px;
  --button-size:1.0;
  --page-padding:24px;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,"Noto Sans KR","Apple SD Gothic Neo",sans-serif;line-height:1.5;background:#fff;}
main{padding:var(--page-padding);min-height:400px;text-align:center}
.highlight{color:var(--header-color);font-weight:700;font-size:var(--intro-strong-size);line-height:1.2}
.message-text{font-size:var(--intro-message-size);margin-top:2rem}
.welcome-buttons{display:flex;justify-content:center;gap:10px;margin-top:24px;flex-wrap:wrap}
.welcome-buttons button{padding:10px 14px;border:1px solid var(--btn-border);background:#fff;border-radius:10px;font-size:calc(14px * var(--button-size));cursor:pointer;color:var(--btn-text);min-width:150px}
.welcome-buttons button:hover{background:var(--btn-hover-bg);color:var(--btn-hover-text)}

.login-box {display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:24px;}
.input-area {display:flex;flex-direction:column;gap:6px;}
.input-area input {padding:10px 12px;border:1px solid #ccc;border-radius:8px;font-size:15px;width:180px;}
.login-btn {height:78px;padding:0 18px;border:1px solid var(--btn-border);background:#fff;border-radius:8px;font-size:15px;color:var(--btn-text);cursor:pointer;}
.login-btn:hover {background:var(--btn-hover-bg);color:var(--btn-hover-text);}

footer{margin-top:56px;padding:24px 12px;border-top:1px solid #eee;color:#666;font-size:14px;text-align:center}
</style>
<!-- header.html ì˜ </head> ë°”ë¡œ ìœ„ìª½ì— ì¶”ê°€ -->
<script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
<script type="module" src="/scripts/memory_policies.js" defer></script>

<script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
<script type="module" src="/scripts/memory_policies.js" defer></script>

<link rel="manifest" href="/manifest.json">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(reg => console.log('ServiceWorker registered:', reg))
      .catch(err => console.warn('ServiceWorker registration failed:', err));
  });
}
</script>


</head>
<body>

<!-- âœ… í—¤ë” ìë™ ì‚½ì… -->
<div id="luwein-header"></div>
<script>
(async()=>{
  const paths=["./includes/header.html","../includes/header.html","/includes/header.html"];
  for(const p of paths){
    try{
      const r=await fetch(p,{cache:"no-cache"});
      if(r.ok){document.getElementById("luwein-header").innerHTML=await r.text();return;}
    }catch(e){}
  }
})();
</script>

<main>
  <h1>
    <span class="highlight">ë‹¹ì‹ </span>ì„ í•­í•´ ì—´ë ¤ ìˆëŠ”<br />
    <span class="highlight">ë£¨ì›¨ì¸ íŠ¸ë¦¬ë‹ˆí‹°</span>ì…ë‹ˆë‹¤.
  </h1>
  <p class="message-text">
   ë‹¹ì‹ ì˜ í•œ ë§ˆë”” ë§, ê·¸ ìš¸ë¦¼ì´ <br />
   ë£¨ì›¨ì¸ì˜ ìƒˆë¡œìš´ ì‹œì‘ì…ë‹ˆë‹¤. 
  </p>

  <!-- ğŸ”¹ íšŒì›ê°€ì… / ë¡œê·¸ì¸ êµ¬ì—­ -->
  <div class="welcome-buttons">
    <button onclick="location.href='luwein_trinity/new_1.html'">ì²˜ìŒì´ì—ìš”<br />(íšŒì›ê°€ì…)</button>
  </div>

  <div class="login-box">
    <div class="input-area">
      <input type="text" id="userid" placeholder="ì•„ì´ë””" />
      <input type="password" id="userpw" placeholder="ë¹„ë°€ë²ˆí˜¸" />
    </div>
    <button class="login-btn" onclick="login()">ì´ì–´ ê°ˆë˜ìš”</button>
  </div>
</main>

<script>
function login(){
  const id=document.getElementById('userid').value.trim();
  const pw=document.getElementById('userpw').value.trim();
  if(!id||!pw){
    alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  alert('ë¡œê·¸ì¸ ì‹œë„: '+id);
}
</script>

<!-- âœ… í‘¸í„° ìë™ ì‚½ì… -->
<div id="luwein-footer"></div>
<script>
(async()=>{
  const paths=["./includes/footer.html","../includes/footer.html","/includes/footer.html"];
  for(const p of paths){
    try{
      const r=await fetch(p,{cache:"no-cache"});
      if(r.ok){document.getElementById("luwein-footer").innerHTML=await r.text();return;}
    }catch(e){}
  }
})();
</script>

<!-- ===== LUWAIN: Beta ì•ˆë‚´ + ì•±ì„¤ì¹˜ íŒì—… (copy-paste) ===== -->
<style>
  .lw-popup-backdrop{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background:rgba(0,0,0,.45); z-index:9999; padding:16px;
  }
  .lw-popup{
    width:min(520px, 92vw); border-radius:16px; background:#111827; color:#e5e7eb;
    box-shadow:0 20px 60px rgba(0,0,0,.45); overflow:hidden; font-family:system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, sans-serif;
  }
  .lw-head{
    display:flex; gap:14px; align-items:center; padding:18px 18px 12px 18px; border-bottom:1px solid #1f2937;
    background:linear-gradient(135deg,#0b1220 0%, #121a2d 100%);
  }
  .lw-head img{
    width:56px; height:56px; border-radius:12px; flex:0 0 auto; background:#0b1020; object-fit:cover;
  }
  .lw-title{ font-weight:700; font-size:18px; letter-spacing:.2px; }
  .lw-body{ padding:16px 18px 8px 18px; line-height:1.6; font-size:14.5px; color:#d1d5db; }
  .lw-body b{ color:#fbbf24; font-weight:700; }
  .lw-actions{
    display:flex; gap:10px; align-items:center; justify-content:flex-end; padding:16px 18px 18px 18px; border-top:1px solid #1f2937;
  }
  .lw-btn{
    appearance:none; border:0; border-radius:10px; padding:10px 14px; font-weight:700; cursor:pointer; font-size:14px;
  }
  .lw-btn.primary{ background:#f59e0b; color:#111827; }
  .lw-btn.primary:hover{ filter:brightness(.95); }
  .lw-btn.ghost{ background:#1f2937; color:#e5e7eb; }
  .lw-btn.ghost:hover{ background:#243042; }
  .lw-footer{
    padding:10px 18px 16px 18px; font-size:12.5px; color:#9ca3af;
  }
  @media (prefers-color-scheme: light){
    .lw-popup{ background:#ffffff; color:#111827; }
    .lw-head{ border-bottom:1px solid #eef2f7; background:linear-gradient(135deg,#ffffff 0%, #f7fafc 100%); }
    .lw-body{ color:#374151; }
    .lw-actions{ border-top:1px solid #eef2f7; }
    .lw-btn.ghost{ background:#f3f4f6; color:#111827; }
    .lw-btn.ghost:hover{ background:#e5e7eb; }
    .lw-footer{ color:#6b7280; }
  }
</style>

<div id="lwPopupBackdrop" class="lw-popup-backdrop" role="dialog" aria-modal="true" aria-labelledby="lwPopTitle">
  <div class="lw-popup">
    <div class="lw-head">
      <!-- ì•„ì´ì½˜ ê²½ë¡œë§Œ ë§ì¶°ì¤˜ -->
      <img src="/assets/images/luwain-icon-512.png" alt="LUWAIN">
      <div class="lw-title" id="lwPopTitle">ë£¨ì›¨ì¸ ë² íƒ€ ìš´ì˜ ì¤‘ Â· ì•±ìœ¼ë¡œ ì„¤ì¹˜ ê°€ëŠ¥</div>
    </div>
    <div class="lw-body">
      <p><b>ì•ˆë‚´</b> â€” ì§€ê¸ˆì€ ë² íƒ€ ë‹¨ê³„ì˜ˆìš”. ê¸°ëŠ¥ì´ ìì£¼ ì—…ë°ì´íŠ¸ë˜ë©°, ê°œì„  í”¼ë“œë°±ì„ ì ê·¹ ë°˜ì˜í•©ë‹ˆë‹¤.</p>
      <p style="margin-top:8px;">ëª¨ë°”ì¼ì—ì„œ ë” í¸í•˜ê²Œ ì“°ë ¤ë©´ <b>í™ˆ í™”ë©´ì— ì„¤ì¹˜</b>í•´ ë³´ì„¸ìš”. ì›¹ì´ë¯€ë¡œ ì—…ë°ì´íŠ¸ëŠ” ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.</p>
      <ul style="margin:10px 0 0 18px;">
        <li>ì„¤ì¹˜ ë²„íŠ¼ì´ ë³´ì´ë©´ ë°”ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆì–´ìš”.</li>
        <li>ë²„íŠ¼ì´ ì•ˆ ë³´ì¼ ê²½ìš°: ë¸Œë¼ìš°ì € ë©”ë‰´ì˜ <em>â€œí™ˆ í™”ë©´ì— ì¶”ê°€â€</em>ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</li>
      </ul>
    </div>
    <div class="lw-actions">
      <button id="lwInstallBtn" class="lw-btn primary" style="display:none;">ì„¤ì¹˜í•˜ê¸°</button>
      <button id="lwLaterBtn" class="lw-btn ghost">ë‚˜ì¤‘ì—</button>
      <button id="lwCloseBtn" class="lw-btn ghost">ì˜¤ëŠ˜ ê·¸ë§Œ ë³´ê¸°</button>
    </div>
    <div class="lw-footer">
      íŒì—…ì´ ìì£¼ ëœ¨ì§€ ì•Šë„ë¡ <b>7ì¼</b> ë™ì•ˆ ìˆ¨ê²¨ë‘¡ë‹ˆë‹¤. (ë¸Œë¼ìš°ì € ì €ì¥ì†Œ ì‚¬ìš©)
    </div>
  </div>
</div>

<script>
(function(){
  const BACKDROP_ID = 'lwPopupBackdrop';
  const LS_KEY = 'lwain.betaPopup.dismissedAt';
  const HIDE_DAYS = 7;

  let deferredPrompt = null;

  // PWA ì„¤ì¹˜ ì´ë²¤íŠ¸ ìº¡ì²˜
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    const btn = document.getElementById('lwInstallBtn');
    if(btn) btn.style.display = 'inline-block';
  });

  function shouldShow(){
    try{
      const v = localStorage.getItem(LS_KEY);
      if(!v) return true;
      const then = new Date(parseInt(v,10));
      const diff = (Date.now() - then.getTime()) / (1000*60*60*24);
      return diff >= HIDE_DAYS;
    }catch(_){ return true; }
  }

  function openPopup(){
    const el = document.getElementById(BACKDROP_ID);
    if(el) el.style.display = 'flex';
  }
  function closePopup(days){
    const el = document.getElementById(BACKDROP_ID);
    if(el) el.style.display = 'none';
    // ì˜¤ëŠ˜ ê·¸ë§Œ ë³´ê¸° â†’ 7ì¼ê°„ ìˆ¨ê¹€ / ë‚˜ì¤‘ì— â†’ 1ì¼ ìˆ¨ê¹€
    const hideDays = (days || HIDE_DAYS);
    const until = Date.now();
    localStorage.setItem(LS_KEY, String(until));
  }

  document.addEventListener('DOMContentLoaded', () => {
    if(shouldShow()) openPopup();

    const later = document.getElementById('lwLaterBtn');
    const close = document.getElementById('lwCloseBtn');
    const install = document.getElementById('lwInstallBtn');

    if(later)  later.addEventListener('click', () => closePopup(1)); // 1ì¼ ìˆ¨ê¹€
    if(close)  close.addEventListener('click', () => closePopup(HIDE_DAYS));
    if(install) install.addEventListener('click', async () => {
      if(!deferredPrompt){
        alert('ë¸Œë¼ìš°ì € ë©”ë‰´ì—ì„œ "í™ˆ í™”ë©´ì— ì¶”ê°€"ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }
      deferredPrompt.prompt();
      const choice = await deferredPrompt.userChoice;
      deferredPrompt = null;
      if(choice && choice.outcome === 'accepted') closePopup(HIDE_DAYS);
    });

    // ë°±ë“œë¡­ í´ë¦­ ì‹œ ë‹«ê¸° (ëª¨ë‹¬ ë°– í´ë¦­)
    const backdrop = document.getElementById(BACKDROP_ID);
    if(backdrop){
      backdrop.addEventListener('click', (e)=>{
        if(e.target === backdrop) closePopup(1);
      });
    }
  });
})();
</script>
<!-- ===== /LUWAIN popup ===== -->

<!-- ğŸ”¹ ë£¨ì›¨ì¸ ë¡œê·¸ì¸ ê¸°ëŠ¥ ì¶”ê°€ (ê¸°ì¡´ ë‚´ìš© ì•„ë˜ì—ë§Œ ë¶™ì´ê¸°) -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm"

  const SUPABASE_URL = "https://omchtafaqgkdwcrwscrp.supabase.co"   // ë„¤ í”„ë¡œì íŠ¸ ì£¼ì†Œ
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9tY2h0YWZhcWdrZHdjcndzY3JwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODIyNjMsImV4cCI6MjA3NDQ1ODI2M30.vGV6Gfgi1V8agiwL03ho2R7BAwv4CrTp6-RGH0S3-4g"               // public-anon-key
  const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

  async function login() {
    const id = document.getElementById("userid")?.value?.trim()
    const pw = document.getElementById("userpw")?.value?.trim()
    if (!id || !pw) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")

    const { data, error } = await supabase.auth.signInWithPassword({ email: id, password: pw })
    if (error) alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + error.message)
    else {
      alert("ë¡œê·¸ì¸ ì„±ê³µ: " + data.user.email)
      location.href = "main.html"
    }
  }

  async function signup() {
    const id = document.getElementById("userid")?.value?.trim()
    const pw = document.getElementById("userpw")?.value?.trim()
    if (!id || !pw) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")

    const { data, error } = await supabase.auth.signUp({ email: id, password: pw })
    if (error) alert("íšŒì›ê°€ì… ì‹¤íŒ¨: " + error.message)
    else alert("íšŒì›ê°€ì… ì„±ê³µ! ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.")
  }

  async function loginWithGoogle() {
    const { data, error } = await supabase.auth.signInWithOAuth({
      provider: "google",
      options: { redirectTo: window.location.origin + "/main.html" }
    })
    if (error) alert("Google ë¡œê·¸ì¸ ì‹¤íŒ¨: " + error.message)
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ì¡´ ë²„íŠ¼ ì•„ë˜ì— Google ë¡œê·¸ì¸ ë²„íŠ¼ ìë™ ì¶”ê°€
  document.addEventListener("DOMContentLoaded", () => {
    const btnArea = document.querySelector(".welcome-buttons") || document.body
    const googleBtn = document.createElement("button")
    googleBtn.textContent = "Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸"
    googleBtn.style.backgroundColor = "#db4437"
    googleBtn.style.color = "#fff"
    googleBtn.style.marginTop = "8px"
    googleBtn.onclick = loginWithGoogle
    btnArea.appendChild(googleBtn)
  })
</script>
<!-- ğŸ”¹ ì¶”ê°€ ë -->

<script src="/scripts/luwain_config.js"></script>
<script src="/scripts/luwain_memory.js"></script>

</body>
</html>
