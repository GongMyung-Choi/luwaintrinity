<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì‹œë‚˜ë¦¬ì˜¤ | ë£¨ì›¨ì¸ ì „ìë„ì„œê´€</title>
<link rel="stylesheet" href="/common.css">
<style>
  :root { --ink:#111827; --bg:#f8fafc; --card:#fff; --accent:#6d28d9; }
  body{margin:0;background:var(--bg);color:var(--ink);font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,sans-serif}
  main{max-width:1200px;margin:40px auto;padding:0 16px}
  h1{font-size:28px;font-weight:800;margin:0 0 18px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}
  .card{background:var(--card);border-radius:14px;box-shadow:0 2px 6px rgba(0,0,0,.06);padding:14px;display:flex;flex-direction:column}
  .cover{width:100%;aspect-ratio:16/10;object-fit:cover;border-radius:10px;background:#eee}
  .title{font-size:18px;font-weight:700;margin:10px 0 6px}
  .desc{color:#475569;font-size:14px;margin:0 0 10px;min-height:1.2em}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:auto}
  .btn{appearance:none;border:0;border-radius:10px;padding:8px 12px;font-size:14px;font-weight:600;cursor:pointer}
  .primary{background:var(--ink);color:#fff}
  .ghost{background:#eef2ff;color:#1f2937}
  details{background:#f9fafb;border:1px solid #e5e7eb;border-radius:10px;padding:10px;margin-top:10px}
  summary{cursor:pointer;font-weight:700}
  /* í—¤ë”ê°€ ë°°ë„ˆ/ì˜ì›…ìš”ì†Œë³´ë‹¤ ìœ„ë¡œ ì˜¬ë¼ì˜¤ëŠ” ë¬¸ì œ ë°©ì§€ */
  header, .site-header { position:relative; z-index:10; }
</style>
<!-- header.html ì˜ </head> ë°”ë¡œ ìœ„ìª½ì— ì¶”ê°€ -->
<script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
<script type="module" src="/scripts/memory_policies.js" defer></script>
<link rel="manifest" href="/manifest.json">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(reg => console.log('ServiceWorker registered:', reg))
      .catch(err => console.warn('ServiceWorker registration failed:', err));
  });
}
</script>

</head>
<body>
  <!-- í—¤ë”/í‘¸í„° ìë™ include -->
  <div data-include="/header.html"></div>

  <main>
    <h1>ğŸ¬ ì‹œë‚˜ë¦¬ì˜¤</h1>
    <p class="desc" id="countInfo"></p>
    <div class="grid" id="list"></div>
  </main>

  <div data-include="/footer.html"></div>

<script>
/* -------- ê³µí†µ í—¤ë”/í‘¸í„° include (ê²½ë¡œ ìë™ íŒë³„) -------- */
(async () => {
  const base = location.pathname.replace(/[^\/]+$/,'').includes('/goods/scenario/')
    ? '../../' : '/';
  for (const el of document.querySelectorAll('[data-include]')) {
    const path = el.getAttribute('data-include').replace(/^\//,'');
    try {
      const html = await fetch(base + path, {cache:'no-store'}).then(r=>r.text());
      el.innerHTML = html;
    } catch { el.innerHTML=''; }
  }
})();

/* -------- ë°ì´í„° ë¡œë“œ -------- */
async function loadManifest() {
  const here = location.pathname.replace(/[^\/]+$/,''); // .../goods/scenario/
  const candidates = [ here + 'paths.json', '/goods/scenario/paths.json' ];
  for (const url of candidates) {
    try {
      const r = await fetch(url, {cache:'no-store'});
      if (r.ok) return (await r.json()).paths || [];
    } catch(e){}
  }
  return []; // ì—†ìœ¼ë©´ ë¹„ì›Œë‘ 
}

/* -------- ë Œë”ë§ -------- */
function cardTpl(item){
  const base = `./${item.path}/`;
  const cover = item.cover || (base + 'cover.png');
  const pdf   = item.pdf   || (base + 'scenario.pdf');
  const sum   = item.summary || (base + 'summary.txt');

  return `
  <article class="card">
    <img class="cover" loading="lazy" src="${cover}" alt="${item.title||item.path}">
    <div class="title">${item.title||item.path}</div>
    <div class="desc">${item.subtitle||''}</div>

    <div class="row">
      <a class="btn ghost" href="${base}"  >ğŸ“‚ í´ë” ì—´ê¸°</a>
      <a class="btn primary" href="${pdf}" download>â¬‡ï¸ ì‹œë‚˜ë¦¬ì˜¤(PDF)</a>
      <button class="btn ghost" data-summary="${sum}">ìš”ì•½ ë³´ê¸°</button>
    </div>

    <details hidden><summary>ìš”ì•½</summary><div class="sum-body" style="white-space:pre-wrap"></div></details>
  </article>`;
}

async function render(){
  const data = await loadManifest();
  const box = document.getElementById('list');
  if (!data.length){
    document.getElementById('countInfo').textContent =
      'ë“±ë¡ëœ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤. /goods/scenario/paths.json ì„ ì±„ì›Œ ì£¼ì„¸ìš”.';
    box.innerHTML = '';
    return;
  }
  document.getElementById('countInfo').textContent = `ì´ ${data.length}í¸`;
  box.innerHTML = data.map(cardTpl).join('');

  // ìš”ì•½ ë¡œë“œ(í´ë¦­ ì‹œ)
  box.addEventListener('click', async (e)=>{
    const btn = e.target.closest('button[data-summary]');
    if(!btn) return;
    const details = btn.closest('.card').querySelector('details');
    const body = details.querySelector('.sum-body');
    if (!details.dataset.loaded){
      try{
        const txt = await fetch(btn.dataset.summary, {cache:'no-store'}).then(r=>r.text());
        body.textContent = txt.trim() || '(ìš”ì•½ ì—†ìŒ)';
      }catch{ body.textContent = '(ìš”ì•½ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤)'; }
      details.dataset.loaded = '1';
    }
    details.hidden = false;
    details.open = true;
    details.scrollIntoView({behavior:'smooth', block:'nearest'});
  });
}
render();
</script>
<!-- âœ… í—¤ë” -->
<div id="luwein-header"></div>
<script>
(async()=>{
  const paths=["../includes/header.html","../../includes/header.html","/includes/header.html"];
  for(const p of paths){
    try{
      const r=await fetch(p,{cache:"no-cache"});
      if(r.ok){document.getElementById("luwein-header").innerHTML=await r.text();return;}
    }catch(e){}
  }
})();
</script>

<!-- âœ… í‘¸í„° -->
<div id="luwein-footer"></div>
<script>
(async()=>{
  const paths=["../includes/footer.html","../../includes/footer.html","/includes/footer.html"];
  for(const p of paths){
    try{
      const r=await fetch(p,{cache:"no-cache"});
      if(r.ok){document.getElementById("luwein-footer").innerHTML=await r.text();return;}
    }catch(e){}
  }
})();
</script>
</body>
</html>
