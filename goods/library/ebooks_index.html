<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ğŸ“– ë£¨ì›¨ì¸ ì „ìì±… ë¼ì´ë¸ŒëŸ¬ë¦¬</title>
<style>
body{font-family:'Noto Sans KR',sans-serif;background:#f9f9f9;margin:0;}
header{background:#004d60;color:#fff;padding:20px;text-align:center;font-size:1.6rem;font-weight:700;}
main{max-width:1100px;margin:0 auto;padding:24px;}
.section{margin-bottom:48px;}
.section h2{color:#004d60;border-left:6px solid #007f91;padding-left:10px;margin-bottom:12px;}
.subsection h3{color:#555;border-left:4px solid #aaa;padding-left:8px;margin-top:20px;margin-bottom:10px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px;}
.card{background:#fff;border-radius:12px;box-shadow:0 3px 6px rgba(0,0,0,0.12);padding:16px;}
.card h4{margin:0 0 6px;font-size:1.05rem;color:#005b78;}
.card a{text-decoration:none;color:inherit;}
.badges{margin-top:4px;}
.badge{display:inline-block;background:#cce7ea;color:#333;padding:4px 8px;border-radius:6px;font-size:0.8rem;margin:2px;}
footer{text-align:center;padding:16px;color:#666;font-size:0.9rem;}
</style>
<!-- header.html ì˜ </head> ë°”ë¡œ ìœ„ìª½ì— ì¶”ê°€ -->
<script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
<script type="module" src="/scripts/memory_policies.js" defer></script>

</head>
<body>
<header>ğŸ“š ë£¨ì›¨ì¸ ì „ìì±… ë¼ì´ë¸ŒëŸ¬ë¦¬ (E-Books)</header>
<main id="library"></main>
<footer>ë£¨ì›¨ì¸ ë””ì§€í„¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ Â· ì „ìì±… Â© 2025</footer>

<script>
// ğŸ“˜ 1ï¸âƒ£ ì „ìì±… ëª©ë¡ (ìë™í™” ê°€ëŠ¥)
const sources = [
  './ebooks/a_301/summary.txt',
  './ebooks/a_401/summary.txt',
  './ebooks/a_501/summary.txt'
];

// ğŸ“˜ 2ï¸âƒ£ summary.txt ë¶„ì„
async function parseSummary(path){
  const res = await fetch(path);
  const text = await res.text();
  const title = (text.match(/Title:\s*(.*)/i)||[])[1]||'ì œëª© ë¯¸ìƒ';
  const category = (text.match(/Category:\s*(.*)/i)||[])[1]||'ë¯¸ë¶„ë¥˜';
  const sub = (text.match(/Sub:\s*(.*)/i)||[])[1]||'ê¸°íƒ€';
  const file = (text.match(/File:\s*(.*)/i)||[])[1]||'';
  const tagsLine = (text.match(/Tags:\s*(.*)/i)||[])[1]||'';
  const summary = (text.match(/Summary:\s*([\s\S]*)/i)||[])[1]||'';
  const tags = tagsLine.split(/[#,]/).map(t=>t.trim()).filter(Boolean);

  // ìë™ ê°ì‘ íƒœê·¸
  const auto=[];
  const lower=summary.toLowerCase();
  if(/ì–¸ì–´|communication/.test(lower)) auto.push('ì–¸ì–´');
  if(/ì² í•™|ì¡´ì¬|ì˜ë¯¸/.test(lower)) auto.push('ì² í•™');
  if(/ì˜ˆìˆ |art|ê°ì„±|ì°½ì˜/.test(lower)) auto.push('ì˜ˆìˆ ');
  if(/ê¸°ìˆ |ai|system|tech/.test(lower)) auto.push('ê¸°ìˆ ');
  const allTags=[...new Set([...tags,...auto])];
  return {title,category,sub,file,tags:allTags,summary};
}

// ğŸ“˜ 3ï¸âƒ£ ì¸ë±ìŠ¤ êµ¬ì„±
async function buildLibrary(){
  const container=document.getElementById('library');
  const items=await Promise.all(sources.map(parseSummary));
  const grouped={};

  // ëŒ€ë¶„ë¥˜>ì¤‘ë¶„ë¥˜
  items.forEach(({title,category,sub,file,tags,summary})=>{
    if(!grouped[category]) grouped[category]={};
    if(!grouped[category][sub]) grouped[category][sub]=[];
    grouped[category][sub].push({title,file,tags,summary});
  });

  // ì¶œë ¥
  for(const cat in grouped){
    const section=document.createElement('section');
    section.className='section';
    section.innerHTML=`<h2>${cat}</h2>`;
    const subCats=grouped[cat];

    for(const sub in subCats){
      const subsection=document.createElement('div');
      subsection.className='subsection';
      subsection.innerHTML=`<h3>${sub}</h3><div class="grid"></div>`;
      const grid=subsection.querySelector('.grid');

      subCats[sub].forEach(({title,file,tags,summary})=>{
        const div=document.createElement('div');
        div.className='card';
        const badges=tags.map(t=>`<span class="badge">#${t}</span>`).join('');
        const link=file?`<a href="${file}" target="_blank"><h4>${title}</h4></a>`:`<h4>${title}</h4>`;
        div.innerHTML=`${link}<p>${summary.slice(0,100)}...</p><div class="badges">${badges}</div>`;
        grid.appendChild(div);
      });
      section.appendChild(subsection);
    }
    container.appendChild(section);
  }
}
buildLibrary();
</script>
</body>
</html>
