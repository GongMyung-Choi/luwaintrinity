<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>공유된 클립</title>

<!-- supabase client 로딩 -->
<script type="module" src="/os/assets/js/core/supabase_client.js"></script>

<style>
  body {
    font-family: sans-serif;
    padding: 20px;
  }
  .clip-item {
    margin-bottom: 40px;
  }
  iframe {
    width: 100%;
    max-width: 560px;
    height: 315px;
  }
</style>
</head>

<body>
  <h1>공유된 클립</h1>
  <div id="clipsContainer"></div>

<script type="module">
  import { supabase } from "/os/assets/js/core/supabase_client.js";

  async function loadClips() {
    const { data, error } = await supabase
      .from("clips_records")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) {
      console.error("불러오기 실패:", error);
      return;
    }

    const container = document.getElementById("clipsContainer");
    container.innerHTML = "";

    data.forEach((clip) => {
      const div = document.createElement("div");
      div.className = "clip-item";

      div.innerHTML = `
        <h3>${clip.title || "제목 없음"}</h3>
        <iframe
          src="${convertToEmbed(clip.youtube_url)}"
          frameborder="0"
          allowfullscreen
        ></iframe>
        <p>${clip.description || ""}</p>
      `;

      container.appendChild(div);
    });
  }

  function convertToEmbed(url) {
    if (url.includes("watch?v=")) {
      return url.replace("watch?v=", "embed/");
    }
    if (url.includes("youtu.be")) {
      return url.replace("youtu.be/", "www.youtube.com/embed/");
    }
    return url;
  }

  loadClips();
</script>

</body>
</html>
