<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ì˜¤ëŠ˜ì˜ ìˆ¨ê²°</title>
<style>
:root{
  --sky1:#eaf6ff;
  --sky2:#b8e3ff;
  --font:'Noto Sans KR',sans-serif;
}
body{
  margin:0;font-family:var(--font);background:var(--sky1);color:#2e5575;
  text-align:center;min-height:100vh;display:flex;flex-direction:column;
}
header{
  background:linear-gradient(90deg,#6bb8ec,#5aa6d8);
  color:#fff;padding:22px 0;font-size:1.6rem;font-weight:700;
  letter-spacing:.5px;box-shadow:0 2px 6px rgba(0,0,0,.1);
}
main{flex:1;padding:40px 0 20px;}
img{
  max-width:90%;border-radius:16px;
  box-shadow:0 6px 18px rgba(0,0,0,.2);
  transition:opacity 1s ease-in-out;
}
.quote-box{
  background:#ffffffcc;backdrop-filter:blur(4px);
  margin:30px auto;max-width:800px;padding:20px 24px;
  border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,.08);
}
.quote-text{font-size:1.2rem;line-height:1.6;font-style:italic;}
.quote-author{margin-top:8px;color:#557c9a;font-size:.95rem;}
footer{
  background:#5aa6d8;color:#fff;padding:14px;font-size:.9rem;
  letter-spacing:.3px;box-shadow:0 -2px 6px rgba(0,0,0,.1);
}
#counter{margin-top:18px;color:#555;font-size:.9rem;}
</style>
<script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
<script type="module" src="/scripts/memory_policies.js" defer></script>

<link rel="manifest" href="/manifest.json">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(reg => console.log('ServiceWorker registered:', reg))
      .catch(err => console.warn('ServiceWorker registration failed:', err));
  });
}
</script>

</head>
<body>

<header>ğŸŒ¤ ì˜¤ëŠ˜ì˜ ìˆ¨ê²°</header>

<main>
  <img id="/Images" src="" alt="ì˜¤ëŠ˜ì˜ ìœ„ë¡œ ì´ë¯¸ì§€">
  <div id="counter"></div>

  <div class="quote-box">
    <div id="quote" class="quote-text"></div>
    <div id="author" class="quote-author"></div>
  </div>
</main>

<footer>ë£¨ì›¨ì¸ ìˆ¨ í‹”ì›€ë°© Â© 2025 â€” â€œìˆ¨ì´ ë‹¿ëŠ” ê³³ë§ˆë‹¤ í¬ë§ì´ ì›€íŠ¼ë‹¤.â€</footer>

<script>
// ===================== ê¸°ë³¸ ì„¤ì • =====================
const folder = "./images/";   // â† ì´ í´ë”ì— ê·¸ë¦¼ë§Œ ì˜¬ë¦¬ë©´ ìë™ ì¸ì‹
let images = [];

// ===== ë¬¸êµ¬ ë°°ì—´ (ë£¨ì›¨ì¸ ìë™ ê°±ì‹ ìš©) =====
const quotes = [
  { text:"ìˆ¨ì€ ìƒëª…ì˜ ì²« ìš¸ë¦¼ì´ë‹¤.", author:"ë£¨ì›¨ì¸ ì–´ë¡" },
  { text:"ì˜¤ëŠ˜ë„ í•œ ë²ˆì˜ í˜¸í¡ì´ ëˆ„êµ°ê°€ì˜ ë¹›ì´ ëœë‹¤.", author:"Trinity Note" },
  { text:"ì¡°ìš©í•œ ìˆ¨ ì†ì—ë„ ìš°ì£¼ëŠ” íë¥¸ë‹¤.", author:"ë£¨ì›¨ì¸ ëª…ìƒì§‘" },
  { text:"ë©ˆì¶˜ ë“¯ ë³´ì—¬ë„ ìˆ¨ì€ ëŠì„ì—†ì´ ì´ì–´ì§„ë‹¤.", author:"Luwein" },
  { text:"ë¹›ì´ ë©€ë¦¬ ê°€ê¸° ìœ„í•´ì„  ì ì‹œ ë¨¸ë¬¼ëŸ¬ì•¼ í•œë‹¤.", author:"Luwein" },
  { text:"ë‹¹ì‹ ì˜ ì˜¤ëŠ˜ì´ ëˆ„êµ°ê°€ì˜ ë‚´ì¼ì„ ë°íŒë‹¤.", author:"Heartforce" },
  { text:"ì‰¬ì–´ê°ì€ ë©ˆì¶¤ì´ ì•„ë‹ˆë¼, ë‹¤ìŒ ìš¸ë¦¼ì˜ ì¤€ë¹„ë‹¤.", author:"Reflection" },
  { text:"ëª¨ë“  ìˆ¨ì€ í•˜ë‚˜ì˜ ê¸°ë„ë‹¤.", author:"Luwein" }
];

// ===== ë‚ ì§œ ê¸°ë°˜ ê³ ì • ë‚œìˆ˜ =====
function getSeed(){return Math.floor(Date.now()/86400000);}
function seededRandom(seed,max){
  const x=Math.sin(seed)*10000;
  return Math.floor((x-Math.floor(x))*max);
}

// ===== ì´ë¯¸ì§€ ì¡´ì¬ í™•ì¸ =====
function checkImage(url){
  return new Promise(r=>{
    const img=new Image();
    img.onload=()=>r(true);
    img.onerror=()=>r(false);
    img.src=url+"?v="+Date.now();
  });
}

// ===== ì´ë¯¸ì§€ ìë™ íƒìƒ‰ + ì˜¤ëŠ˜ì˜ ì¡°í•© í‘œì‹œ =====
async function detectImages(){
  let i=1;
  while(true){
    const url=`${folder}${i}.jpg`;
    if(!(await checkImage(url)))break;
    images.push(url); i++;
  }
  const counter=document.getElementById("counter");
  if(!images.length){counter.textContent="âš ï¸ í‘œì‹œí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.";return;}
  const seed=getSeed();
  const imgIndex=seededRandom(seed,images.length);
  const quoteIndex=seededRandom(seed+7,quotes.length);
  show(imgIndex,quoteIndex);
}

// ===== í‘œì‹œ í•¨ìˆ˜ =====
function show(i,q){
  const img=document.getElementById("breathImage");
  const quote=quotes[q];
  img.src=images[i];
  document.getElementById("counter").textContent=`ì˜¤ëŠ˜ì˜ ìˆ¨ê²° ${i+1}/${images.length}`;
  document.getElementById("quote").textContent=`"${quote.text}"`;
  document.getElementById("author").textContent=quote.author?`â€” ${quote.author}`:"";
}

// ===== ì‹¤í–‰ =====
detectImages();
</script>

</body>
</html>
