<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ë‚´ í¼ìŠ¤ë‚˜ ë³´ê¸°</title>
<style>
body{font-family:'Noto Sans KR',sans-serif;margin:0;background:#f9f9f9;color:#333;text-align:center;padding:20px;}
h1{color:#af2465;margin-bottom:10px;}
#viewBox{
  background:#fff;border:1px solid #eee;border-radius:14px;
  max-width:700px;margin:0 auto;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.05);
}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:10px;border-bottom:1px solid #eee;}
th{background:#fdf2f6;color:#af2465;}
button{margin:12px 6px;padding:10px 16px;border:none;border-radius:8px;background:#2a9d8f;color:#fff;cursor:pointer;}
button:hover{filter:brightness(1.1);}
.meta{color:#666;font-size:.9rem;margin-top:8px;}
</style>
</head>
<body>
<h1>ğŸª ë‚´ í¼ìŠ¤ë‚˜ ë³´ê¸°</h1>
<div id="viewBox">
  <p>ë¡œì»¬ ë˜ëŠ” í´ë¼ìš°ë“œì— ì €ì¥ëœ í¼ìŠ¤ë‚˜ ì„¤ì •ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  <table>
    <thead><tr><th>ì†ì„±</th><th>ê°’</th></tr></thead>
    <tbody id="personaData"><tr><td colspan="2">ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr></tbody>
  </table>
  <div class="meta" id="timestamp">â€”</div>

  <div style="margin-top:16px;">
    <button id="loadLocal">ë¡œì»¬ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <button id="loadCloud">â˜ï¸ í´ë¼ìš°ë“œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  </div>
</div>

<script type="module">
import { supabase } from '/assets/js/supabase.js';

// í…Œì´ë¸” í‘œì‹œ í•¨ìˆ˜
function renderTable(data){
  const tbody=document.getElementById('personaData');
  tbody.innerHTML='';
  for(const [k,v] of Object.entries(data)){
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${k}</td><td>${v}</td>`;
    tbody.appendChild(tr);
  }
}

// ë¡œì»¬ ë¶ˆëŸ¬ì˜¤ê¸°
document.getElementById('loadLocal').onclick=()=>{
  const raw=localStorage.getItem('luwein_persona');
  if(!raw){alert('ë¡œì»¬ì— ì €ì¥ëœ í¼ìŠ¤ë‚˜ê°€ ì—†ìŠµë‹ˆë‹¤.');return;}
  const data=JSON.parse(raw);
  renderTable(data);
  document.getElementById('timestamp').textContent='ğŸ“¦ ë¡œì»¬ ë°ì´í„° ë¶ˆëŸ¬ì˜´';
};

// í´ë¼ìš°ë“œ ë¶ˆëŸ¬ì˜¤ê¸°
document.getElementById('loadCloud').onclick=async()=>{
  const { data, error } = await supabase
    .from('personas')
    .select('content, updated_at')
    .order('updated_at', { ascending:false })
    .limit(1);
  if(error||!data?.length){alert('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨ ë˜ëŠ” ë°ì´í„° ì—†ìŒ');return;}
  const persona=JSON.parse(data[0].content);
  renderTable(persona);
  document.getElementById('timestamp').textContent='â˜ï¸ í´ë¼ìš°ë“œ ê¸°ì¤€: '+new Date(data[0].updated_at).toLocaleString('ko-KR');
};
</script>
</body>
</html>
