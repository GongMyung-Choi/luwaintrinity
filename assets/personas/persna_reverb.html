<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í¼ìŠ¤ë‚˜ ê³µëª…(å…±é³´) ë°œìƒì†Œ | Luwein Reverberation</title>
<style>
body{font-family:'Noto Sans KR',sans-serif;background:#d6f5e3;margin:0;text-align:center;padding:20px;}
h1{color:#3e7c66;margin-bottom:10px;}
#recordList{max-width:700px;margin:auto;background:#fff;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.08);padding:20px;}
button{margin-top:15px;padding:10px 20px;border:none;border-radius:8px;background:#4ca880;color:#fff;cursor:pointer;}
button:hover{background:#3e7c66;}
#reactionCanvas{margin-top:30px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
</style>
</head>
<body>
<h1>ğŸŒŠ í¼ìŠ¤ë‚˜ê³µëª…(å…±é³´) ë°œìƒì†Œ</h1>
<p>í¼ìŠ¤ë‚˜ë“¤ì˜ ê¸°ë¡ì´ ì„œë¡œì—ê²Œ ìš¸ë¦¼ì„ ë³´ë‚´ ìƒˆë¡œìš´ ì¡°í•©ì„ ì‹œë„í•©ë‹ˆë‹¤.</p>
<div id="recordList">ê¸°ë¡ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
<canvas id="reactionCanvas" width="360" height="360"></canvas>

<script>
async function loadRecords(){
  const list=document.getElementById('recordList');
  try{
    const res=await fetch('/goods/library/persna_records/');
    const text=await res.text();
    const matches=[...text.matchAll(/href="([^"]+\.txt)"/g)];
    if(matches.length===0){list.innerHTML="<p>ë“±ë¡ëœ í¼ìŠ¤ë‚˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>";return;}
    list.innerHTML=matches.map(m=>{
      const name=m[1].replace('persna_memory_','').replace('.txt','');
      return `<button onclick="readRecord('${m[1]}')">ğŸ“œ ${name}</button>`;
    }).join('<br>');
  }catch{
    list.innerHTML="<p>GitHub Pagesì—ì„œëŠ” ìë™ íƒìƒ‰ì´ ì œí•œë©ë‹ˆë‹¤. íŒŒì¼ ì§ì ‘ ë§í¬ë¡œ ì ‘ê·¼í•´ì£¼ì„¸ìš”.</p>";
  }
}

const canvas=document.getElementById("reactionCanvas");
const ctx=canvas.getContext("2d");
let pulse=0, dir=1;

function drawReverb(color){
  ctx.clearRect(0,0,360,360);
  const grad=ctx.createRadialGradient(180,180,20,180,180,150);
  grad.addColorStop(0,"#fff");
  grad.addColorStop(1,color);
  ctx.fillStyle=grad;
  ctx.fillRect(0,0,360,360);
  ctx.beginPath();
  ctx.arc(180,180,80+pulse,0,Math.PI*2);
  ctx.strokeStyle=color;
  ctx.lineWidth=5;
  ctx.stroke();
  pulse+=dir*1.5;
  if(pulse>20||pulse<0) dir*=-1;
  requestAnimationFrame(()=>drawReverb(color));
}

async function readRecord(file){
  const res=await fetch('/goods/library/persna_records/'+file);
  const text=await res.text();
  const heroCount=(text.match(/ê°ì •|ë§ˆìŒ|ì‚¬ë‘|ê¸°ì–µ|ë¹›/g)||[]).length;
  const daonCount=(text.match(/ì‚¬ëŒ|í•¨ê»˜|ìš°ë¦¬|ì—°ê²°/g)||[]).length;
  const yeoulCount=(text.match(/ë§|ì–¸ì–´|ì†Œë¦¬|ì‹œ/g)||[]).length;
  const recaCount=(text.match(/í˜•íƒœ|ì§ˆì„œ|êµ¬ì¡°|í‹€/g)||[]).length;

  const r=Math.min(255,80+heroCount*20);
  const g=Math.min(255,120+daonCount*20);
  const b=Math.min(255,150+yeoulCount*20);
  const color=`rgba(${r},${g},${b},0.8)`;
  drawReverb(color);
  alert(`í¼ìŠ¤ë‚˜ê°€ ë°˜ì‘í–ˆìŠµë‹ˆë‹¤.\nê°ì •:${heroCount}, ê´€ê³„:${daonCount}, ì–¸ì–´:${yeoulCount}, êµ¬ì¡°:${recaCount}`);
}

loadRecords();
drawReverb("rgba(100,180,160,0.6)");
</script>
</body>
</html>
