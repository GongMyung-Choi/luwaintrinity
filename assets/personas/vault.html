<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ğŸ“š ë‚´ ë³´ê´€í•¨ | ë£¨ì›¨ì¸</title>
<style>
:root{--accent:#af2465;}
body{margin:0;font-family:'Noto Sans KR',sans-serif;background:#fafafa;color:#333;}
header{background:var(--accent);color:#fff;text-align:center;padding:18px;font-size:1.4rem;}
nav{display:flex;justify-content:center;gap:10px;background:#fff;padding:10px;border-bottom:1px solid #eee;}
nav button{padding:8px 14px;border:1px solid var(--accent);border-radius:8px;background:#fff;color:var(--accent);cursor:pointer;}
nav button.active{background:var(--accent);color:#fff;}
.section{display:none;padding:20px;}
.section.active{display:block;}
.card{background:#fff;border-radius:12px;padding:16px;margin:12px auto;max-width:700px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);}
.date{color:#888;font-size:.9rem;margin-bottom:6px;}
footer{text-align:center;padding:16px;color:#666;font-size:.85rem;}
</style>
</head>
<body>
<header>ğŸ“š ë‚´ ë³´ê´€í•¨</header>

<nav>
  <button data-tab="helper" class="active">ğŸ’Œ ìœ„ë¡œ ì¹´ë“œ</button>
  <button data-tab="creator">ğŸ¨ ì‘í’ˆí•¨</button>
  <button data-tab="research">ğŸ”¬ ì—°êµ¬ ë¡œê·¸</button>
</nav>

<main>
  <div id="helper" class="section active">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="creator" class="section">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="research" class="section">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</main>

<footer>ë£¨ì›¨ì¸ í¼ìŠ¤ë‚˜ ì‹œìŠ¤í…œ Â© 2025</footer>

<script type="module">
<script type="module">
import { loadPersonaHeader } from "/assets/js/persona_ui.js";
loadPersonaHeader();
</script>

import { supabase } from "/assets/js/supabase.js";


const user = JSON.parse(localStorage.getItem("ed_user") || '{"name":"ìµëª…"}');
const tabButtons = document.querySelectorAll("nav button");
tabButtons.forEach(btn=>{
  btn.addEventListener("click",()=>{
    tabButtons.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    document.getElementById(btn.dataset.tab).classList.add("active");
  });
});

async function loadVault(){
  const helper = document.getElementById("helper");
  const creator = document.getElementById("creator");
  const research = document.getElementById("research");

  // Helper
  let { data, error } = await supabase.from("helper_cards").select("*").eq("user_name", user.name).order("created_at",{ascending:false});
  if(error) helper.textContent="ì˜¤ë¥˜:"+error.message;
  else helper.innerHTML = data.length ? data.map(c=>`<div class="card"><div class="date">${new Date(c.created_at).toLocaleString()}</div>${c.message}</div>`).join("") : "ì•„ì§ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.";

  // Creator
  ({ data, error } = await supabase.from("creator_works").select("*").eq("user_name", user.name).order("created_at",{ascending:false}));
  if(error) creator.textContent="ì˜¤ë¥˜:"+error.message;
  else creator.innerHTML = data.length ? data.map(c=>`<div class="card"><div class="date">${new Date(c.created_at).toLocaleString()}</div>${c.content}</div>`).join("") : "ì €ì¥ëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.";

  // Research
  ({ data, error } = await supabase.from("research_logs").select("*").eq("user_name", user.name).order("created_at",{ascending:false}));
  if(error) research.textContent="ì˜¤ë¥˜:"+error.message;
  else research.innerHTML = data.length ? data.map(c=>`<div class="card"><div class="date">${new Date(c.created_at).toLocaleString()}</div>${c.result}</div>`).join("") : "ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.";
}
loadVault();
</script>
</body>
</html>
